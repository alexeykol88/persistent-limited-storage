{"version":3,"file":"index.js","sources":["../src/storageNode.ts","../node_modules/sizeof/lib/sizeof.js","../node_modules/sizeof/index.js","../src/limitedstorage.ts"],"sourcesContent":["//template for storage node\nexport class StorageNode {\n    key: string;\n    value: any;\n    prev: StorageNode | null;\n    next: StorageNode | null;\n    \n    constructor(key: string, value: any){\n      this.key = key;\n      this.value = value;\n      this.prev = null;\n      this.next = null;\n    }\n}","var sizeof = sizeof || {};\r\nsizeof.sizeof = function(object, pretty) {\r\n    var objectList = [];\r\n    var stack = [object];\r\n    var bytes = 0;\r\n\r\n    while (stack.length) {\r\n        var value = stack.pop();\r\n\r\n        if(typeof value === 'boolean'){\r\n            bytes += 4;\r\n        }else if(typeof value === 'string'){\r\n            bytes += value.length * 2;\r\n        }else if(typeof value === 'number'){\r\n            bytes += 8;\r\n        }else if(typeof value === 'object' && objectList.indexOf( value ) === -1){\r\n            objectList.push(value);\r\n            // if the object is not an array, add the sizes of the keys\r\n            if (Object.prototype.toString.call(value) != '[object Array]'){\r\n                for(var key in value) bytes += 2 * key.length;\r\n            }\r\n            for(var key in value) stack.push(value[key]);\r\n        }\r\n    }\r\n    return pretty ? sizeof.format(bytes) : bytes;\r\n}\r\nsizeof.format = function(bytes){\r\n    if(bytes < 1024) return bytes + \"B\";\r\n    else if(bytes < 1048576) return(bytes / 1024).toFixed(3) + \"K\";\r\n    else if(bytes < 1073741824) return(bytes / 1048576).toFixed(3) + \"M\";\r\n    else return(bytes / 1073741824).toFixed(3) + \"G\";\r\n}\r\nexports = module.exports = sizeof;","\r\nexports = module.exports = require('./lib/sizeof');","  import {IStorage, IStorageParams} from 'store';\r\n  import {StorageNode} from './storageNode';\r\n  import 'sizeof';\r\n\r\n  interface IStore {\r\n    [key: string]: any;\r\n  }\r\n\r\n  export class Storage implements IStorage {\r\n    private head : StorageNode | null;\r\n    private tail: StorageNode | null;\r\n    private store : IStore;\r\n    private limit : number;\r\n    private sizeof : any;\r\n    private useLocalStorage: boolean;\r\n    private globalKey : string;\r\n\r\n  constructor(params: IStorageParams) {\r\n    this.limit = params.limit;\r\n    if (params.useLocalStorage && params.limit > 10 * 1024 * 1024) {\r\n      this.limit = 10 * 1024 * 1024;\r\n      console.warn(\"Max limit for local storage is 10mb, your storage limit set to 10mb.\")\r\n      }\r\n    this.useLocalStorage = params.useLocalStorage;\r\n    this.globalKey = params.globalKey;\r\n    this.sizeof = require('sizeof').sizeof;\r\n    this.store = {};\r\n    this.head = null;\r\n    this.tail = null;\r\n    if (this.useLocalStorage) {\r\n      this.getDataFromLocalStorage();\r\n    }\r\n  }\r\n\r\n  public getFreeSpace() {\r\n    return this.limit - this.sizeof(this.store);\r\n  }\r\n\r\n  public set(key: string, value: any): void {\r\n      const node = new StorageNode(key, value);\r\n      const size = this.sizeof(node);\r\n      \r\n      if (this.limit < size) {\r\n      return;\r\n      }\r\n\r\n      if (this.store[node.key]) {\r\n        this.store[node.key].value = value;\r\n        this.remove(node.key);\r\n      }\r\n       \r\n      while (this.getFreeSpace() < size) {\r\n        if (this.tail !== null) {\r\n          this.remove(this.tail.key);\r\n        }\r\n        else {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.setHead(node);\r\n\r\n      if (this.useLocalStorage) {\r\n        this.setToLocalStorage();\r\n      }\r\n  }\r\n  \r\n  private setToLocalStorage(): any {\r\n    const storeToSave = Object.keys(this.store).map(key => \r\n      ({ key: key, value: this.store[key].value })).reduce(\r\n        (f, s) => { f[s.key] = s; return f; }, {} as IStore)\r\n        localStorage.setItem(this.globalKey, JSON.stringify(storeToSave))\r\n  } \r\n\r\n  public get(key: string): any{\r\n\r\n    if (!this.store[key]) {\r\n      return null;\r\n    }\r\n\r\n    return this.store[key].value;\r\n  }\r\n\r\n  private getDataFromLocalStorage(): any {\r\n     const fromLS = JSON.parse(localStorage.getItem(this.globalKey) || \"{}\");\r\n     Object.keys(fromLS).forEach(key => {\r\n      this.set(key, fromLS[key].value);\r\n    });\r\n  }\r\n\r\n  public remove(key: string): any {\r\n     const node = this.store[key];\r\n     \r\n     if(!node){\r\n       return null;\r\n     }\r\n      \r\n     let value = JSON.parse(JSON.stringify(node.value));\r\n\r\n     if (node.prev !== null) {\r\n       node.prev.next = node.next;\r\n     }\r\n     else {\r\n       this.head = node.next;\r\n     }\r\n\r\n     if(node.next !==  null) {\r\n       node.next.prev = node.prev;\r\n     }\r\n     else {\r\n       this.tail = node.prev;\r\n     }\r\n\r\n     delete this.store[key];\r\n\r\n     if (this.useLocalStorage) {\r\n      this.setToLocalStorage();\r\n   }\r\n\r\n   return value;\r\n  }\r\n\r\n  public clearStorage() {\r\n    this.store = {};\r\n    this.head = null;\r\n    this.tail = null;\r\n\r\n    if (this.useLocalStorage) {\r\n      this.setToLocalStorage();\r\n    }\r\n  }\r\n\r\n  private setHead(node: StorageNode) {\r\n    node.next = this.head;\r\n    node.prev = null;\r\n\r\n    if (this.head !== null) {\r\n      this.head.prev = node;\r\n    }\r\n    this.head = node;\r\n\r\n    if (this.tail === null) {\r\n      this.tail = node;\r\n    }\r\n    this.store[node.key] = node;\r\n  }\r\n}\r\n"],"names":["require$$0"],"mappings":"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"}